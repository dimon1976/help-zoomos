# Автоматическая загрузка прайс-листов

## Настройка загрузки прайс-листов из почтового ящика

1\. Переходим во вкладку _"Настройки"_ -> _"Настройка прайсов"_

2\. Добавляем новую строку<br>
![Добавление новой строки](../../../_assets/price-handler/auto/Screenshot_2024_09_29-9.png)

3\. Заполнение адреса ссылки.

**Формула:**  
> `mail://info@gmail.com:12345/price@mail.ru/ACC Distribution/АСС`

**Пояснение:**

- _info@gmail.com_ - адрес вашей почты
- _12345_ - пароль от почты
- _price@mail.ru_ - адрес отправителя (можно не заполнять)
- _ACC Distribution_ - тема письма (можно указать только часть названия, если оно постоянно меняется)
- _АСС_ - название вложенного прайса (указывать без даты)

### Пример формулы без заполнения адреса отправителя:
> `mail://info@gmail.com:12345/ /ACC Distribution/АСС`

Если прайс указывается с датой, то пишем только первую часть названия, без цифр:  
Пример: `price_10_08_16.xls` -> `price`

{% note info %}

Если необходимо указывать дату в имени прайса, можно использовать шаблон для дат:
> `10_08_16` заполняется как - `[DD]_[MM]_[YY]`
> `10.08.2024` заполняется как - `[DD].[MM].[YYYY]`<br>
D - число месяца
M - номер месяца
Y - год.

{% endnote %}

**Формула:**  
> `mail://info@gmail.com:12345/price@mail.ru/ACC Distribution/price`

4\. Заполнение необходимых столбцов.

Заполняем полученную ссылку и указываем необходимые столбцы. Для одного прайса можно задать сразу несколько "целей" загрузки в разные вкладки в системе.

![Пример заполнения столбцов](../../../_assets/price-handler/auto/Screenshot_2024_09_29-2.png)

### Пример письма в почтовом ящике

![Пример письма](../../../_assets/price-handler/auto/Screenshot_2024_09_29-3.png)

### Варианты итоговой ссылки

> `mail://info@gmail.com:12345/noreply@nereida.by/Прайс-лист (Нереида)/Nereida price-list`
>
> `mail://info@gmail.com:12345/@nereida.by/прайс/price`

5\. Завершение настройки.

Когда все нужные столбцы заполнены, просто закрываем окно.

6\. Проверка правильности настройки прайса.

Нажимаем _"Запустить"_ напротив нашей ссылки:

![Кнопка запуска](../../../_assets/price-handler/auto/Screenshot_2024_09_29-4.png)

7\. Проверка загруженного прайса.

Прайс загрузится в указанную вкладку, где его можно проверить.

## Настройки почты
Необходимо убедиться, что в настройках почты разрешен доступ по протоколу IMAP:

### Imap

{% list tabs %}

- Yandex

  ![протокол IMAP](../../../_assets/price-handler/auto/Screenshot_2024_10_01-1(1).png)

- Gmail

  ![протокол IMAP](../../../_assets/price-handler/auto/Screenshot_2024_10_01-2.png)

{% endlist %}

<br>

Почтовые сервисы yandex, gmail и др. в целях безопасности не предоставляют доступ сторонним приложениям к почте и др. сервисам. Для разрешения загрузки прайс листов из почты, требуется создать специальный пароль для приложения zoomos. 

### Включение двухэтапной аутентификации:


{% list tabs %}

- Yandex mail

  Включение двухэтапной аутентификации не обязательно для включения пароля приложений.


- Gmail

  ![Двухэтапная аутентификация](../../../_assets/price-handler/auto/Screenshot_2024_10_01-5.png)

{% endlist %}


<br>

### Добавление пароля приложения:

{% list tabs %}

- Yandex mail

  {% cut "Включить пароль для приложений" %}

  ![Пароль приложения яндекс почта, включить](../../../_assets/price-handler/auto/Screenshot_2024_10_06-1.png)

  {% endcut %}

  {% cut "Добавить пароль для приложения" %}

  ![Добавить пароль для приложения](../../../_assets/price-handler/auto/Screenshot_2024_10_06-4.png =700x400)

  {% endcut %}

  {% cut "Сохранить полученный пароль" %}

  ![Сохранить полученный пароль](../../../_assets/price-handler/auto/Screenshot_2024_10_06-7.png)

  {% endcut %}


- Gmail

  {% cut "Создать пароль для приложений" %}

  ![Пароль приложения яндекс почта, включить](../../../_assets/price-handler/auto/Screenshot_2024_10_06-5.png =425x400)

  {% endcut %}

  {% cut "Сохранить полученный пароль" %}

  ![Добавить пароль для приложения](../../../_assets/price-handler/auto/Screenshot_2024_10_06-6.png =425x400)

  {% endcut %}
  
  
{% endlist %}

**При настройке загрузки прайсов из почты, необходимо указывать imap сервер и порт:**

{% note info %}

{% list tabs %}

- Yandex mail

  _IMAP сервер_ - `imap.yandex.ru`
  _порт_ - `993`


- Gmail

  _IMAP сервер_ - `imap.gmail.com`
  _порт_ - `993`
  
{% endlist %}

{% endnote %}


## Настройка прайсов из Dropbox

1\. Переходим во вкладку _"Настройки"_ -> _"Настройка прайсов"_

2\. Добавляем новую строку и прописываем нужную ссылку/[отмечаем столбцы](./price-handler.md#пример-сопоставления-столбцов)

### Форматирование ссылки для Dropbox
- Переходим на прайс по ссылке Dropbox (например, прайс Gardena)

**Пример ссылки:**

> `https://www.dropbox.com/sh/thtu4k8k0gbyulh/AAC8AVfBHEdlB3yL8TrJiUmMa/Gardena.xls?dl=0`

**Преобразуем в:**

> `https://www.dropbox.com/sh/thtu4k8k0gbyulh/AAC8AVfBHEdlB3yL8TrJiUmMa/Gardena.xls?dl=1&pv=1`

**Замена:**  
`dl=0` на `dl=1&pv=1` (в конце ссылки)

3\. Применение полученной ссылки.

Готово, полученную ссылку можно использовать.


## Настройка прайсов из Google Docs

### Пример ссылки

> `https://docs.google.com/spreadsheets/d/1MV6qMbxkV5Gw-S7nV13HrOSvJq41xkMgSCITXQshnKQ/pub?output=html`

### Формула для скачивания в формате Excel
Необходимо заменить последнюю часть после `/` на `/export?exportFormat=xlsx`.

**Пример:**

> `https://docs.google.com/spreadsheets/d/1MV6qMbxkV5Gw-S7nV13HrOSvJq41xkMgSCITXQshnKQ/pub?output=html`

**Преобразуем в:**

> `https://docs.google.com/spreadsheets/d/1MV6qMbxkV5Gw-S7nV13HrOSvJq41xkMgSCITXQshnKQ/export?exportFormat=xlsx`

### Формула для загрузки вкладки в формате CSV

Заменяем `/edit#gid=1615075392` на `/export?exportFormat=csv&gid=1053932382`:

> _gid=1615075392_ - идентификатор нужной вкладки.

**Пример:**

> `https://docs.google.com/spreadsheets/d/1knVFWPz3a6_aH7nvtsaeSka2nH0yAriGvZAEsJ6o-gE/edit#gid=1615075392`

**Преобразуем в:**

> `https://docs.google.com/spreadsheets/d/1knVFWPz3a6_aH7nvtsaeSka2nH0yAriGvZAEsJ6o-gE/export?exportFormat=csv&gid=1053932382`

{% note warning %}

Вкладка всегда указывается под номером 1.

{% endnote %} 


Прайс по ссылке Google Docs можно настроить только если он **_"опубликован"_**:

> _Файл_->_Поделиться_->_Опубликовать в интернете_


## Настройка прайсов с FTP

1\. Переходим во вкладку _"Настройки"_ -> _"Настройка прайсов"_

2\. Добавляем новую строку.

3\. Заполнение адреса ссылки.

**Формула:**  
> `ftp://zoomos:12345@ftp.site.by/Zoomos.csv`

**Пояснение:**

- _ftp.site.by_ - адрес FTP
- _12345_ - пароль
- _zoomos_ - логин
- _Zoomos.csv_ - название файла


## Автоматическая загрузка по расписанию.

{% note info %}

Автоматическую загрузку прайс-листов можно настроить по расписанию, в удобное для вас время.

{% endnote %}
